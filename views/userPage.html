<!DOCTYPE html>
<html>
<head>
  <title>SXDiscover</title>
  <link rel="stylesheet" type="text/css" href="/stylesheets/reset.css">
  <link rel="stylesheet" type="text/css" href="/stylesheets/userpage.css">
  <link rel="stylesheet" href="/stylesheets/vex.css" />
  <link rel="stylesheet" type="text/css" href="/stylesheets/snackbar.css">
  <link rel="stylesheet" href="/stylesheets/vex-theme-wireframe.css" />


  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- <meta name="viewport" content="width=device-width initial-scale = 1.0 maximum-scale=1.0 user-scalable=no" /> -->
  <link rel="shortcut icon" href="http://sxdiscover.co/favicon.ico?v=2">

  <!-- Facebook link previews -->
    <!-- You can use Open Graph tags to customize link previews.
      Learn more: https://developers.facebook.com/docs/sharing/webmasters -->
      <meta property="fb:app_id"        content="618293678380263" />
      <meta property="og:url"           content="{{link}}" />
      <meta property="og:type"          content="website" />
      <meta property="og:title"         content="{{fbShareMessage}}" />
      <meta property="og:description"   content="Log in with Spotify to find out if your favorite bands are playing SXSW." />
      <meta property="og:image"         content="http://sxdiscover.co/images/sxd.png" />
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-75031530-1', 'auto');
        ga('send', 'pageview');
      </script>
    </head>
    <body class="site">
      <div id="snackbar"></div>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
      <script src="/javascripts/global.js"></script>
      <script src="/javascripts/date.js"></script>
      <script src="/javascripts/moment.js"></script>
      <script src="/javascripts/vex.combined.min.js"></script>
      <script>vex.defaultOptions.className = 'vex-theme-wireframe';</script>

      <!-- UPDATE: 2017 Facebook SDK code for share button -->
      <div id="fb-root"></div>
      <script>(function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.8&appId=618293678380263";
        fjs.parentNode.insertBefore(js, fjs);
      }(document, 'script', 'facebook-jssdk'));
    </script>
    <script>


      $(document).ready(function() {
        vex.dialog.alert({ unsafeMessage: 'Here\'s your SXSW schedule for the week, pulled from your top Spotify artists and their related artists. <br /><br />‚úåüèΩ‚úåüèª,<br />- Mathew + Ben'})
      });

      // Function to show toast at the top. Borrowed from https://www.w3schools.com/howto/howto_js_snackbar.asp
      function showToast(text) {
      // Get the snackbar DIV
      var x = document.getElementById("snackbar");
      x.innerHTML = text;

      // Add the "show" class to DIV
      x.className = "show";

      // After 3 seconds, remove the show class from DIV
      setTimeout(function(){ x.className = x.className.replace("show", ""); }, 2500);
      }


      // Function that adds an event handler for each "Save to calendar button". index tells us which date and show the "Save to calendar" button was clicked for.
      function addCalendarButtonEventHandler(index, name, venue, date, time, link){
        var year = (new Date()).getFullYear() // Get current year
        var month = 3 // Assuming all shows are in March
        var hour = Date.parse(time).getHours()
        var min = Date.parse(time).getMinutes()
        var endHour;
        if(hour==23){
          endHour = 0
        } else {
          endHour = hour+1
        }

        var startDateTime = year+"-"+month+"-"+date+"T"+hour+":"+min+":00"
        var endDateTime = year+"-"+month+"-"+date+"T"+endHour+":"+min+":00"

        var eventData = {
          'summary': 'SXSW: '+name,
          'location': venue,
          'description': link,
          'start': startDateTime,
          'end': endDateTime
        }

        $("#saveToCalendar-"+index).click(function(e){
          console.log("Save to calendar button clicked!")
          e.preventDefault();
          $.ajax({
            datatype:"json",
            type: 'POST',
            url: '/calendar',
            data: eventData,
            success: function(result){
              if(result.status==200){
                showToast("Show added to calendar.");
                // some UI indication that the calendar event was added
              } else {
                // some UI indication that the calendar event was not added
                showToast("Error adding show to calendar.");
              }
            }
          })
        })
      }

      function addCheckboxEventHandler(index){
        $("#checkbox-"+index).click(function(e){
          console.log("checkbox " + index + " clicked!");
        })
      }

    </script>
    <div class="add-shows-tooltip">
      <div class="add-shows-tooltip__text">Add shows to your schedule</div>
    </div>

    <div class="showlist">
    {{#if shows}}
    <form name="showsForm">
      {{#each shows}}
      <div class="show__day">{{this.day}}, March {{this.date}}</div>
      {{#each shows}}
      <div class="show">
        <div class="show__time-wrapper">
          <div class="show__time">{{this.time}}</div>
        </div>
        <div class="show__info">
          <a href="{{this.link}}" target="_blank"><div class="show__band">{{this.name}}</div></a>
          <h3 class="show__source">Test</h3>
          <h3 class="show__venue">{{this.venue}}</h3>
          <h3 class="show__price">{{this.price}}</h3>
          <div id="saveToCalendar-{{@../index}}-{{@index}}" class="calendar-button">Save to calendar</div>
        </div>
        <script>
          var name = "{{this.name}}"
          var venue = "{{this.venue}}"
          var date = "{{../this.date}}"
          var time = "{{this.time}}"
          var link = "{{this.link}}"
          addCalendarButtonEventHandler("{{@../index}}-{{@index}}",name,venue,date,time,link)
          addCheckboxEventHandler("{{@../index}}-{{@index}}")
        </script>
        <div class="show__add-button">
          <input type="checkbox" id="checkbox-{{@../index}}-{{@index}}" class="show__add-button-hide-radio">
          <img src="/images/add-button.svg" class="show__add-button__image"></input>
        </div>
      </div>
      {{/each}}
      {{/each}}
    </form>
    {{else}}
    </div> 
      <br /><br />
      <div class="no-shows-placeholder">No shows found yet üòû</div>
      <div class="no-shows-placeholder">Don't worry ‚Äì¬†new shows are added every day. Check back soon!</div>
      {{/if}}
    </div>
    <div class="go-to-schedule" id="go-to-schedule">
      <div class="go-to-schedule__button-text">
        Go to schedule
      </div>
    </div>

<script>
        function getCheckedShows(form){
          console.log("clicked goToSchedule!");
          var savedShows = [];

          for (var i = 0; i < form.elements.length; i++ ) {
            if (form.elements[i].checked == true) {
              savedShows.push(form.elements[i].id);
            }
          }
          console.log(savedShows);
        }
      </script> 


  </div>

  <!-- navigation -->
  <footer id="footer">
  </footer>

  <script>

    $('#changeStatus').click(function(){
      $.get("/private", function(data) {
        location.reload();
      }); return false;
    });

    $('#changeStatus1').click(function(){
      $.get("/private", function(data) {
        location.reload();
      }); return false;
    });

    if("{{canDelete}}"=='y'){
      $(".friendPage").hide();
      if("{{public}}"=='y'){
        $(".public").show();
        $(".private").hide();
      } else {
        $(".public").hide();
        $(".private").show();
      }
    } else {
      $(".friendPage").show();
      $(".public").hide();
      $(".private").hide();
    }

  </script>
</div>
</body>
</html>
