<!DOCTYPE html>
<html>
  <head>
    <title>SXDiscover</title>
    <link rel="stylesheet" type="text/css" href="/stylesheets/reset.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/userpage-style.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/userpage-grid.css">

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- <meta name="viewport" content="width=device-width initial-scale = 1.0 maximum-scale=1.0 user-scalable=no" /> -->
    <link rel="shortcut icon" href="http://sxdiscover.co/favicon.ico?v=2">

    <!-- Facebook link previews -->
    <!-- You can use Open Graph tags to customize link previews.
      Learn more: https://developers.facebook.com/docs/sharing/webmasters -->
    <meta property="fb:app_id"        content="618293678380263" />
    <meta property="og:url"           content="{{link}}" />
    <meta property="og:type"          content="website" />
    <meta property="og:title"         content="{{fbShareMessage}}" />
    <meta property="og:description"   content="Log in with Spotify to find out if your favorite bands are playing SXSW." />
    <meta property="og:image"         content="http://sxdiscover.co/images/sxd.png" />
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-75031530-1', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
  <body class="site">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script src="/javascripts/global.js"></script>
    <script src="/javascripts/date.js"></script>

    <!-- UPDATE: 2017 Facebook SDK code for share button -->
    <div id="fb-root"></div>
    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.8&appId=618293678380263";
      fjs.parentNode.insertBefore(js, fjs);
      }(document, 'script', 'facebook-jssdk'));
    </script>
    <script>

      var results = ['SX'];
      var bands = "{{bands}}";
      var content = '';

      // Remove &quot; and replace with actual quotes
      bands = JSON.parse(bands.replace(/&quot;/g,'"'));


      // Convert date and time into milliseconds to sort by date
      bands.sort(function(a,b){
        if(a["time"]=='tbd'){
          a["time"] = '00:00'
        }
        if(b["time"]=='tbd'){
          b["time"] = '00:00'
        }

        return Date.parse(a["date"]+" 2017 "+a["time"])-Date.parse(b["date"]+" 2017 "+b["time"]);
      });

      $(document).ready(function() {
          populateTable();
      });

      function populateTable() {

              // For each item in our JSON, add a table row and cells to the content string
              $.each(bands, function(){

                  try{
                      var n = this.name;
                      var d = getDate(this.date);
                      var t = "tbd.";
                      var v = this.venue + ".";
                      var l = this.link;
                      if (v == "tbd."){
                        v = "";
                      }

                      if(this.time != "tbd"){
                        t = getTime(this.time) + ".";
                      }

                      if (d == "2016-01-01"){
                          d = "tbd";
                      }

                  for(var i=0;i<results.length; i++){
                  if (results[i][0].date == d){
                    results[i][0].bands.push([n, v, t, l]);
                    break;
                  } else if (i==results.length-1) {
                    results.push([{
                      date:d,
                      bands: [[n, v, t, l]]
                      }]);
                    break;
                    }
                  }
                } catch (e){
                  console.log("Error: Couldn't access bands from /bands response");
                }
              });
                //Remove first element
                // need: 2018 update: remove first day's results
                results = results.slice(1);
          // THIS CREATEs DIVS WITH THE NAMES OF DAYS
                for(var j=0;j<results.length;j++){
                  if(j==0){
                      // content += '<div class="firstdate">~ '+results[j][0].date + ' ~</div>';
                  } else {
                      // content += '<div class="date">~ '+results[j][0].date + ' ~</div>';
                  }
                  for(var k=0;k<results[j][0].bands.length;k++){
                      content += '<a class="card" href=\''+results[j][0].bands[k][3]+'\' target="_blank">';
                      content += '<h2 class="artist">'+results[j][0].bands[k][0]+'</h2><h3 class="venue">'+results[j][0].bands[k][1]+ ' '+results[j][0].bands[k][2]+'</h3>';
                      content += '</a>';
                      }
                  }

              // Inject the whole content string into our existing HTML table
              $('#bandList').html(content);
              $('#publicLink').html(document.location.href);
              $('body').addClass('siteloaded');
      };
    </script>


<!-- header and article (non-nav content) -->
<div class="viewable">
  <h1 class="textlogo">SXDiscover</h1>
  <article id="bandList">
  </article>
</div>
<!-- navigation -->
  <footer>
    <!-- EDIT JAVASCRIPT TO INPUT CALCULATED CURRENT DISPLAY DAY IN THIS H2 -->
    <div class="daycard">
      <h3>currently viewing results from</h3>
      <h2 class="currentday">Monday, March 16th</h2>
    </div>
    <!-- NAV BUTTONS -->
    <button type="button" name="previous">Previous Day</button>
    <button type="button" name="next">Next Day</button>
  </footer>

<!-- Top section of the site -->
      <div id="top">
          <!-- <img id="logo" src="/images/logo.png"> -->

          <!-- Potentially an <a href="">for the about page?</a> -->
          <!-- <div class="friendPage">
            <h2>{{displayMessage}}</h2>
            <h3 id="discoveryours"><a id="discoveryours" href="/login">Discover yours →</a></h3>
          </div> -->
      <!-- <div class="public">
        <h3 id="publicstatusred">Here's your public SXSW itinerary.</h3>
        <h3 id="publicstatus">Share SXDiscover with your friends on Facebook:</h3>
        <div class="fb-share-button" data-href="{{link}}" data-layout="button" data-size="large" data-mobile-iframe="true"><a class="fb-xfbml-parse-ignore" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fdevelopers.facebook.com%2Fdocs%2Fplugins%2F&amp;src=sdkpreparse">Share</a></div> -->
        <!-- <p id="makeitprivate">Itineraries are public by default. If you want to keep yours private, <span id="changeStatus1" class="status"><a href="#" id="killpubliclink">click here →</a></span></p> -->
      </div>
      <!-- <div class="private" id="changeStatus">
        <p id="makeitprivate">This page is private. To share it with your friends, <span id="changeStatus1" class="status"><a href="#" id="killpubliclink">click here →</a></span></p>
      </div> -->
      <script>
    $('#changeStatus').click(function(){
      $.get("/private", function(data) {
        location.reload();
      }); return false;
    });

    $('#changeStatus1').click(function(){
      $.get("/private", function(data) {
        location.reload();
      }); return false;
    });

    if("{{canDelete}}"=='y'){
      $(".friendPage").hide();
      if("{{public}}"=='y'){
        $(".public").show();
        $(".private").hide();
      } else {
        $(".public").hide();
        $(".private").show();
      }
    } else {
        $(".friendPage").show();
        $(".public").hide();
        $(".private").hide();
      }
  </script>
      </div>
  <!-- <article id="bandList"></article>
  </div>
<div id="footer"><a href="/about" alt="about us" id="info">more info →</a></div> -->
</body>
</html>
